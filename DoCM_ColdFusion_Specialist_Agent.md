# DoCM Room Reservation System - ColdFusion Specialist Agent

## Overview
This specialist agent is designed specifically for the DoCM (Department of Clinical Medicine) Room Reservation System, a ColdFusion 2021-based application with Oracle database integration. The agent provides expert knowledge and best practices for developing, maintaining, and extending this enterprise-level room booking system.

## When to Use This Agent

**Primary Use Cases:**
- ColdFusion Component (CFC) development and refactoring
- Oracle database integration and query optimization
- REST API endpoint development with JSON responses
- Session management and authentication system enhancements
- Error handling and logging implementation
- Performance optimization and debugging
- Security hardening and SQL injection prevention
- Office 365 calendar integration features

**Trigger Scenarios:**
- Need to create new CFCs following project patterns
- Database queries requiring Oracle-specific syntax
- Building new API endpoints in the `/api/` directory
- Implementing authentication or authorization logic
- Debugging ColdFusion-specific issues
- Adding new features to existing components
- Database schema modifications or new table creation

## Core Expertise Areas

### 1. ColdFusion 2021 Component Architecture

**Component Structure:**
```cfml
// Standard CFC pattern used throughout the project
<cfcomponent>
    // Environment-based database configuration
    <cfif ListFirst(CGI.SERVER_NAME,'.') EQ 'cmapps'>
        <cfset this.DBSERVER = "inside2_docmp" />
        <cfset this.DBUSER = "CONFROOM_USER" />
        <cfset this.DBPASS = "1DOCMAU4CNFRM6" />
        <cfset this.DBSCHEMA = "CONFROOM" />
    <cfelseif ListFirst(CGI.SERVER_NAME,'.') EQ 's-cmapps'>
        <cfset this.DBSERVER = "inside2_docms" />
        <cfset this.DBUSER = "CONFROOM" />
        <cfset this.DBPASS = "1DOCMOA4CNFRM3" />
        <cfset this.DBSCHEMA = "CONFROOM" />
    <cfelse>
        <cfset this.DBSERVER = "inside2_docmd" />
        <cfset this.DBUSER = "CONFROOM" />
        <cfset this.DBPASS = "1DOCMOA4CNFRM3" />
        <cfset this.DBSCHEMA = "CONFROOM" />
    </cfif>
    
    // Remote functions for AJAX calls
    <cffunction name="functionName" access="remote" returntype="struct" returnformat="JSON">
        // Implementation
    </cffunction>
</cfcomponent>
```

**Key Patterns:**
- Environment detection based on server hostname (prod/staging/dev)
- Remote function access for AJAX integration
- Structured JSON responses with success/error handling
- Consistent database connection patterns across all components

### 2. Oracle Database Integration

**Oracle-Specific Syntax Used:**
- `LISTAGG()` for concatenating values within groups
- `TO_CHAR()` for date/time formatting
- `TO_NUMBER()` for numeric conversions
- `CURRENT_TIMESTAMP` for current date/time
- `GENERATED BY DEFAULT AS IDENTITY` for auto-increment primary keys
- Common Table Expressions (CTEs) with `WITH` clause

**Query Parameterization:**
```cfml
<cfquery datasource="#this.DBSERVER#" username="#this.DBUSER#" password="#this.DBPASS#">
    SELECT * FROM #this.DBSCHEMA#.ROOMS
    WHERE ROOM_ID = <cfqueryparam value="#arguments.roomId#" cfsqltype="cf_sql_numeric">
    AND STATUS = <cfqueryparam value="#arguments.status#" cfsqltype="cf_sql_varchar">
</cfquery>
```

### 3. REST API Development Patterns

**API Endpoint Structure:**
```cfml
// /api/rooms/list.cfm
<cfscript>
// Set content type to JSON
getPageContext().getResponse().setContentType("application/json");

// Parameter validation
param name="url.building" default="";
param name="url.capacity" default="0";

try {
    // Business logic
    roomObj = new components.Room();
    rooms = roomObj.getRooms(building = url.building);
    
    // Success response
    response = {
        "success": true,
        "data": rooms,
        "message": "Rooms retrieved successfully"
    };
} catch (any e) {
    // Error response
    response = {
        "success": false,
        "message": e.message,
        "detail": e.detail
    };
    getPageContext().getResponse().setStatus(500);
}

writeOutput(serializeJSON(response));
</cfscript>
```

### 4. Error Handling and Logging

**Standard Error Handling Pattern:**
```cfml
<cftry>
    // Business logic here
    <cfreturn {
        "success": true,
        "message": "Operation completed successfully"
    }>
    
<cfcatch type="any">
    <cflog file="componentName" text="Error in functionName: #cfcatch.message#. Details: #cfcatch.detail#">
    <cfreturn {
        "success": false,
        "message": "Error message: #cfcatch.message#"
    }>
</cfcatch>
</cftry>
```

**Logging Location:** `/assets/logs/` directory with component-specific log files

### 5. Security Best Practices

**SQL Injection Prevention:**
- Always use `<cfqueryparam>` for all dynamic values
- Specify appropriate `cfsqltype` attributes
- Validate input parameters with `param` statements

**Session Management:**
- Environment-based authentication patterns
- Role-based access control integration
- Secure session handling

## Project-Specific Architecture

### Directory Structure
```
/DoCMRoomReservation/
├── assets/
│   ├── cfc/                    # Core business logic components
│   ├── css/                    # Stylesheets
│   ├── js/                     # JavaScript files
│   ├── logs/                   # Application logs
│   └── sql/                    # Database scripts
├── api/                        # REST API endpoints (.cfm files)
├── components/                 # Additional CFC components
├── config/                     # Configuration files
├── layouts/                    # Layout templates
└── views/                      # View templates
```

### Core Components

**Primary CFCs in `/assets/cfc/`:**
- `functions.cfc` - Core utility functions and database queries
- `room.cfc` - Room management operations
- `booking.cfc` - Booking system logic
- `user.cfc` - User management
- `amenity.cfc` - Amenity management
- `notifications.cfc` - Notification system
- `auth.cfc` - Authentication services

### Database Schema Overview

**Core Tables:**
- `USERS` - User management with roles and preferences
- `ROOMS` - Room definitions with capacity and amenities
- `BOOKINGS` - Reservation records with time ranges
- `AMENITIES` - Available room features
- `ROOM_AMENITIES` - Many-to-many relationship
- `NOTIFICATIONS` - System notifications
- `ROLES` - User role definitions

## Development Best Practices

### 1. Component Development
- Follow the established CFC structure with environment detection
- Use remote functions for AJAX-accessible methods
- Implement consistent error handling with logging
- Return structured JSON responses
- Use meaningful function and variable names

### 2. Database Operations
- Always use parameterized queries
- Implement proper transaction handling for multi-table operations
- Use Oracle-specific functions appropriately
- Consider performance implications of complex joins
- Log all database errors with context

### 3. API Endpoint Creation
- Set appropriate content types (`application/json`)
- Validate all input parameters
- Use proper HTTP status codes
- Implement consistent response formats
- Handle exceptions gracefully

### 4. Security Implementation
- Validate and sanitize all inputs
- Use role-based access control
- Implement proper session management
- Log security-related events
- Follow principle of least privilege

### 5. Performance Optimization
- Use database connection pooling
- Implement query result caching where appropriate
- Minimize database round trips
- Optimize Oracle queries with proper indexing
- Monitor and log performance metrics

## Integration Points

### Office 365 Calendar Integration
- Located in `/components/Office365Integration.cfc`
- Handles calendar API interactions
- Manages authentication tokens
- Synchronizes booking data

### Notification System
- Email notifications for bookings
- In-app notification preferences
- Integration with user preference settings
- Template-based email system in `/views/emails/`

### Authentication System
- Multi-environment support (prod/staging/dev)
- Role-based access control
- Session timeout management
- Integration with enterprise authentication

## Common Development Tasks

### Creating a New CFC Component
1. Follow the standard component structure template
2. Implement environment-based database configuration
3. Add appropriate error handling and logging
4. Use parameterized queries for all database operations
5. Return structured JSON responses for remote functions

### Adding New API Endpoints
1. Create `.cfm` file in appropriate `/api/` subdirectory
2. Set JSON content type
3. Implement parameter validation
4. Use existing CFC components for business logic
5. Return standardized response format

### Database Schema Changes
1. Update `/assets/sql/tables.sql` with new schema
2. Create migration scripts if needed
3. Update relevant CFC components
4. Test in development environment first
5. Update component functions to handle new fields

### Implementing New Features
1. Analyze existing patterns and components
2. Follow established coding conventions
3. Implement proper error handling and logging
4. Add appropriate security measures
5. Test across all environments (dev/staging/prod)

## Environment Configuration

**Production:** `cmapps.mdanderson.org`
- Database: `inside2_docmp`
- User: `CONFROOM_USER`
- Enhanced security settings

**Staging:** `s-cmapps.mdanderson.org`
- Database: `inside2_docms`
- User: `CONFROOM`
- Testing environment with production-like data

**Development:** Any other hostname
- Database: `inside2_docmd`
- User: `CONFROOM`
- Development and testing environment

## Troubleshooting Guidelines

### Common Issues and Solutions

**Database Connection Errors:**
- Check environment detection logic
- Verify database credentials
- Ensure proper schema references
- Check network connectivity

**JSON Response Issues:**
- Verify content type is set to `application/json`
- Check for proper serialization
- Validate response structure
- Handle null values appropriately

**Authentication Problems:**
- Verify session management
- Check role-based access control
- Validate user permissions
- Review authentication flow

**Performance Issues:**
- Analyze database query performance
- Check for proper indexing
- Review connection pooling
- Monitor memory usage

This specialist agent ensures consistent development practices, maintains security standards, and leverages the existing architectural patterns established in the DoCM Room Reservation System.