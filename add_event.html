<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Event</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <style>
        /* Base text color */
        body {
            color: #000;
        }

        /* Form controls */
        .form-control,
        .form-select,
        .flatpickr-input,
        .input-group-text,
        .form-check-label,
        .form-label,
        .accordion-button,
        textarea.form-control::placeholder,
        .form-control::placeholder {
            color: #000 !important;
        }

        /* Icons */
        .input-group-text i,
        .accordion-button i {
            color: #000;
        }

        /* Flatpickr specific */
        .flatpickr-current-month,
        .flatpickr-monthDropdown-months,
        .flatpickr-weekday,
        .flatpickr-day,
        .numInputWrapper span,
        .flatpickr-time .flatpickr-time-separator,
        .numInput.cur-year {
            color: #000 !important;
        }

        /* Form text and hints */
        .form-text {
            color: #000 !important;
        }

        /* Custom Flatpickr Styles */
        .flatpickr-calendar {
            width: 100% !important;
            max-width: 340px;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Calendar header */
        .flatpickr-month {
            margin-bottom: 0.5rem;
            padding: 0.5rem 0;
        }

        /* Calendar days */
        .flatpickr-weekdays {
            padding: 0.5rem 0;
        }

        .flatpickr-day {
            margin: 2px;
            height: 36px;
            line-height: 36px;
            border-radius: 6px;
            width: 36px;
        }

        .flatpickr-day.selected {
            background: #0d6efd;
            border-color: #0d6efd;
        }

        .flatpickr-day:hover {
            background: #e9ecef;
        }

        /* Month navigation arrows */
        .flatpickr-months .flatpickr-prev-month,
        .flatpickr-months .flatpickr-next-month {
            padding: 0.5rem;
        }

        /* Calendar days container */
        .flatpickr-days {
            padding: 0.25rem 0.5rem;
        }

        .dayContainer {
            padding: 0.25rem;
            max-width: none;
            min-width: none;
            width: 100%;
            justify-content: space-between;
            gap: 2px;
        }

        .flatpickr-innerContainer {
            justify-content: center;
        }

        /* Input group */
        .input-group {
            align-items: stretch;
        }

        .input-group-text {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.375rem 0.75rem;
            background-color: #f8f9fa;
            border: 1px solid #ced4da;
            width: 42px;
            margin: 0;
        }

        .form-control,
        .flatpickr-input,
        .input-group>.form-control,
        .input-group>.flatpickr-input {
            height: 38px;
            padding: 0.375rem 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            border: 1px solid #ced4da;
        }

        .input-group>* {
            height: 38px;
        }

        .flatpickr-time {
            border-radius: 0 0 5px 5px;
            height: 44px;
        }

        .flatpickr-input {
            background-color: white !important;
        }

        .input-group .flatpickr-input {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }

        /* Ensure time picker aligns with input */
        .flatpickr-calendar.hasTime.noCalendar {
            width: auto !important;
            min-width: 140px;
        }

        .flatpickr-calendar.hasTime.noCalendar .flatpickr-time {
            border-radius: 5px;
            width: 140px;
        }

        /* Increase size of time picker elements */
        .numInputWrapper {
            height: 100%;
        }

        .numInputWrapper input {
            font-size: 16px !important;
            height: 100% !important;
        }

        .numInputWrapper span {
            padding: 8px 0;
            width: 24px;
            border-width: 2px;
        }

        .numInputWrapper span:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .flatpickr-time .flatpickr-time-separator {
            font-size: 16px;
            height: 100%;
            display: inline-flex;
            align-items: center;
        }

        /* Fix textarea and its input group */
        textarea.form-control {
            min-height: 100px;
            height: auto;
            resize: vertical;
        }

        .input-group:has(textarea) {
            align-items: stretch;
        }

        .input-group:has(textarea) .input-group-text {
            height: 100px;
            align-items: flex-start;
            padding-top: 0.5rem;
        }

        .input-group:has(textarea) .form-control {
            height: 100px;
        }

        /* Fix icon alignment */
        .input-group-text i {
            width: 16px;
            text-align: center;
            line-height: 1;
        }

        /* Ensure select has same height */
        select.form-select {
            height: 38px;
        }
    </style>
</head>

<body>

    <!-- Modal -->
    <div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="addEventModalLabel">
                        <i class="fas fa-calendar-plus me-2"></i>Add Event
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="eventForm" class="needs-validation" novalidate>
                        <div class="mb-3">
                            <label for="eventTitle" class="form-label">Event Title</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-heading"></i></span>
                                <input type="text" class="form-control" id="eventTitle"
                                    placeholder="e.g., Pest Control Visit" required>
                                <div class="invalid-feedback">Please provide an event title.</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="eventDescription" class="form-label">Description</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-align-left"></i></span>
                                <textarea class="form-control" id="eventDescription" rows="3"
                                    placeholder="Event details..." required></textarea>
                                <div class="invalid-feedback">Please provide event details.</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="eventDate" class="form-label">Date</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                <input type="text" class="form-control flatpickr-date" id="eventDate"
                                    placeholder="Select date..." required>
                                <div class="invalid-feedback">Please select a date.</div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="startTime" class="form-label">Start Time</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-clock"></i></span>
                                    <input type="text" class="form-control flatpickr-time" id="startTime"
                                        placeholder="Select start time..." required>
                                    <div class="invalid-feedback">Please select a start time.</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="endTime" class="form-label">End Time</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-clock"></i></span>
                                    <input type="text" class="form-control flatpickr-time" id="endTime"
                                        placeholder="Select end time..." required>
                                    <div class="invalid-feedback">Please select an end time.</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="recurringEvent">
                                <label class="form-check-label" for="recurringEvent">
                                    Recurring Event
                                </label>
                            </div>
                            <div id="recurringOptions" class="mt-2 collapse">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-repeat"></i></span>
                                    <select class="form-select" id="recurringPattern" required disabled>
                                        <option value="">Select recurring pattern...</option>
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="biweekly">Bi-weekly</option>
                                        <option value="monthly">Monthly</option>
                                        <option value="quarterly">Every 3 months</option>
                                        <option value="semi_annual">Every 6 months</option>
                                        <option value="yearly">Yearly</option>
                                    </select>
                                    <div class="invalid-feedback">Please select a recurring pattern.</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Agreement Type</label>
                            <div class="d-flex gap-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="agreementType"
                                        id="serviceAgreement" value="service" required>
                                    <label class="form-check-label" for="serviceAgreement">
                                        Service Agreement
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="agreementType"
                                        id="contractAgreement" value="contract">
                                    <label class="form-check-label" for="contractAgreement">
                                        Contract Agreement
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="fileUpload" class="form-label">Attachments</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-paperclip"></i></span>
                                <input type="file" class="form-control" id="fileUpload"
                                    accept=".pdf,.doc,.docx,.xls,.xlsx">
                            </div>
                            <div class="form-text text-muted">
                                <i class="fas fa-info-circle"></i> Max size: 5MB. Supported: PDF, Word, Excel
                            </div>
                        </div>

                        <div class="accordion mb-3" id="contactDetailsAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#contactDetails">
                                        <i class="fas fa-address-card me-2"></i>Contact Details (Optional)
                                    </button>
                                </h2>
                                <div id="contactDetails" class="accordion-collapse collapse"
                                    data-bs-parent="#contactDetailsAccordion">
                                    <div class="accordion-body">
                                        <div class="mb-3">
                                            <label for="contactName" class="form-label">Contact Name</label>
                                            <input type="text" class="form-control" id="contactName">
                                        </div>
                                        <div class="mb-3">
                                            <label for="contactEmail" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="contactEmail">
                                        </div>
                                        <div class="mb-3">
                                            <label for="contactPhone" class="form-label">Phone</label>
                                            <input type="tel" class="form-control" id="contactPhone">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancel
                    </button>
                    <button type="submit" form="eventForm" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Save Event
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        $(document).ready(function () {
            // Initialize AOS
            AOS.init();

            // Initialize Flatpickr for date
            flatpickr(".flatpickr-date", {
                dateFormat: "Y-m-d",
                minDate: "today",
                allowInput: true
            });

            // Initialize Flatpickr for time
            flatpickr(".flatpickr-time", {
                enableTime: true,
                noCalendar: true,
                dateFormat: "h:i K",
                time_24hr: false,
                minuteIncrement: 15,
                allowInput: true,
                defaultHour: 9
            });

            // Handle recurring event toggle
            const $recurringEvent = $('#recurringEvent');
            const $recurringOptions = $('#recurringOptions');
            const $recurringPattern = $('#recurringPattern');

            const toggleRecurringOptions = () => {
                const isChecked = $recurringEvent.prop('checked');
                $recurringPattern
                    .prop('disabled', !isChecked)
                    .prop('required', isChecked);

                if (!isChecked) {
                    $recurringPattern.val('');
                }

                $recurringOptions.collapse(isChecked ? 'show' : 'hide');
            };

            $recurringEvent.on('change', toggleRecurringOptions);

            // Show modal on page load
            $('#addEventModal').modal('show');

            // Form validation
            const form = document.getElementById('eventForm');
            form.addEventListener('submit', function (event) {
                event.preventDefault();

                if (!form.checkValidity()) {
                    event.stopPropagation();
                    $(form).addClass('was-validated');
                    return;
                }

                // Collect form data
                const formData = {
                    title: $('#eventTitle').val(),
                    date: $('#eventDate').val(),
                    startTime: $('#startTime').val(),
                    endTime: $('#endTime').val(),
                    agreementType: $('input[name="agreementType"]:checked').val(),
                    description: $('#eventDescription').val(),
                    isRecurring: $('#recurringEvent').is(':checked'),
                    recurringPattern: $('#recurringPattern').val(),
                    contactDetails: {
                        name: $('#contactName').val(),
                        email: $('#contactEmail').val(),
                        phone: $('#contactPhone').val()
                    }
                };

                // Handle file upload
                const fileInput = $('#fileUpload')[0];
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    if (file.size > 5 * 1024 * 1024) { // 5MB limit
                        Swal.fire({
                            icon: 'error',
                            title: 'File Too Large',
                            text: 'Please select a file smaller than 5MB'
                        });
                        return;
                    }
                }

                // Show success message
                Swal.fire({
                    icon: 'success',
                    title: 'Event Created',
                    text: 'Your event has been successfully created!',
                    showConfirmButton: false,
                    timer: 1500
                }).then(() => {
                    // Reset form and close modal
                    form.reset();
                    $(form).removeClass('was-validated');
                    $('#addEventModal').modal('hide');
                });
            });

            // Time input validation
            $('#startTime, #endTime').on('change', function () {
                const startTime = $('#startTime').val();
                const endTime = $('#endTime').val();

                if (startTime && endTime && startTime >= endTime) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Invalid Time Range',
                        text: 'End time must be after start time'
                    });
                    $(this).val('');
                }
            });

            // File input validation
            $('#fileUpload').on('change', function () {
                const file = this.files[0];
                if (file) {
                    const fileType = file.type;
                    const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'];

                    if (!validTypes.includes(fileType)) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Invalid File Type',
                            text: 'Please upload only PDF, Word, or Excel files'
                        });
                        this.value = '';
                    }
                }
            });
        });
    </script>
</body>

</html>